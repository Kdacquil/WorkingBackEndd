import{Ha as l,Ja as g,e as n,m as u,p as o,ua as c}from"./chunk-65KWRJAR.js";import{d as t}from"./chunk-U3NIYLHF.js";var E=(()=>{class a{constructor(e,s,r){this.auth=e,this.firestore=s,this.router=r}isAuthenticated(){return this.auth.authState.pipe(n(e=>!!e))}login(e,s){return t(this,null,function*(){try{if(!e||!s)return{success:!1,message:"Email and password are required."};let r=yield this.auth.signInWithEmailAndPassword(e,s);return r.user?r.user.emailVerified?(this.logAudit(e,"LOGIN_SUCCESS","User logged in successfully."),{success:!0,message:"Login successful"}):(yield r.user.sendEmailVerification(),yield this.auth.signOut(),this.logAudit(e,"LOGIN_FAILED","Email not verified."),{success:!1,message:"Email not verified. Verification email sent."}):{success:!1,message:"Login failed. Please try again."}}catch(r){let i=this.getAuthErrorMessage(r);return this.logAudit(e,"LOGIN_FAILED",i),{success:!1,message:i}}})}resendVerificationEmail(){return t(this,null,function*(){try{let e=yield this.auth.currentUser;return e?(yield e.sendEmailVerification(),{success:!0,message:"Verification email sent!"}):{success:!1,message:"No user found."}}catch(e){return console.error("Error sending verification email:",e),{success:!1,message:this.getAuthErrorMessage(e)}}})}getCurrentUser(){return t(this,null,function*(){return this.auth.currentUser})}logout(){return t(this,null,function*(){try{yield this.auth.signOut(),this.router.navigate(["/login"])}catch(e){console.error("Logout error:",e)}})}resetPassword(e){return t(this,null,function*(){try{return yield this.auth.sendPasswordResetEmail(e),{success:!0,message:"Password reset email sent!"}}catch(s){return{success:!1,message:this.getAuthErrorMessage(s)}}})}updateUserInfo(e){return t(this,null,function*(){try{let s=yield this.auth.currentUser;return s?(e.email&&(yield s.updateEmail(e.email)),e.password&&(yield s.updatePassword(e.password)),e.displayName&&(yield s.updateProfile({displayName:e.displayName})),this.logAudit(s.email||"Unknown","UPDATE_USER",`Updated fields: ${Object.keys(e).join(", ")}`),{success:!0,message:"User information updated successfully."}):{success:!1,message:"User not found."}}catch(s){return{success:!1,message:this.getAuthErrorMessage(s)}}})}deleteUserAccount(){return t(this,null,function*(){try{let e=yield this.auth.currentUser;if(!e)return{success:!1,message:"User not found."};let s=e.email||"Unknown";return yield this.firestore.collection("users").doc(e.uid).delete(),yield e.delete(),this.logAudit(s,"DELETE_USER","User account deleted."),{success:!0,message:"User account deleted successfully."}}catch(e){return{success:!1,message:this.getAuthErrorMessage(e)}}})}logAudit(e,s,r){let i={email:e,action:s,details:r,timestamp:new Date};this.firestore.collection("auditLogs").add(i).then(()=>console.log("Audit Log recorded:",i)).catch(d=>console.error("Error logging event:",d))}getAuthErrorMessage(e){switch(e.code){case"auth/invalid-credential":return"Incorrect email or password.";case"auth/user-not-found":return"No user found with this email.";case"auth/wrong-password":return"Wrong password. Please try again.";case"auth/too-many-requests":return"Too many failed attempts. Try again later.";case"auth/requires-recent-login":return"This action requires you to log in again.";default:return"An error occurred. Please try again."}}static{this.\u0275fac=function(s){return new(s||a)(o(l),o(g),o(c))}}static{this.\u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{E as a};
